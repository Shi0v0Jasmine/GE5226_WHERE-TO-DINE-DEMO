# é¡¹ç›®æ–‡ä»¶ä¾èµ–å…³ç³»åˆ†æ

## æ¦‚è§ˆ

æœ¬æ–‡æ¡£è¯¦ç»†è¯´æ˜äº† **GE5226 WHERE-TO-DINE** é¡¹ç›®ä¸­æ‰€æœ‰æ–‡ä»¶ä¹‹é—´çš„ä¾èµ–å…³ç³»ï¼ŒåŒ…æ‹¬ï¼š
- ä»£ç æ¨¡å—ä¾èµ–ï¼ˆimportå…³ç³»ï¼‰
- æ•°æ®æµä¾èµ–ï¼ˆè¾“å…¥/è¾“å‡ºæ–‡ä»¶ï¼‰
- æ‰§è¡Œé¡ºåºä¾èµ–

---

## ä¸€ã€ç³»ç»Ÿæ¶æ„ä¾èµ–å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      ç”¨æˆ·äº¤äº’å±‚                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  app.py      â”‚ â—„â”€â”€â”€ä½¿ç”¨â”€â”€â”€â”€â”€â”€â”€â”€â”‚ templates/          â”‚  â”‚
â”‚  â”‚ (Flask Web)  â”‚                 â”‚   index.html        â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚         â”‚ è¯»å–                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚
          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    æ•°æ®äº§å‡ºå±‚                                 â”‚
â”‚         data/processed/final_hotspots.geojson                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â–²
          â”‚ ç”Ÿæˆ
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  æ•°æ®å¤„ç†æµç¨‹å±‚                               â”‚
â”‚                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚        run_pipeline.py (æµç¨‹æ§åˆ¶å™¨)                  â”‚    â”‚
â”‚  â”‚              æŒ‰é¡ºåºè°ƒç”¨â†“                              â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                               â”‚
â”‚  [Phase 1]  02_process_taxi_data.py                         â”‚
â”‚               â†“ è¾“å‡º: taxi_dropoffs_weighted.parquet        â”‚
â”‚                                                               â”‚
â”‚  [Phase 2]  02_merge_restaurants.py                         â”‚
â”‚               â†“ è¾“å‡º: restaurants_merged.geojson            â”‚
â”‚                                                               â”‚
â”‚  [Phase 3]  06_cluster_restaurants.py                       â”‚
â”‚               â†“ è¾“å…¥: restaurants_merged.geojson            â”‚
â”‚               â†“ è¾“å‡º: dining_zones.geojson                  â”‚
â”‚               â†“       restaurants_clustered.geojson          â”‚
â”‚                                                               â”‚
â”‚  [Phase 4]  07_cluster_taxi_dropoffs.py                     â”‚
â”‚               â†“ è¾“å…¥: taxi_dropoffs_weighted.parquet        â”‚
â”‚               â†“ è¾“å‡º: taxi_hotspots.geojson                 â”‚
â”‚                                                               â”‚
â”‚  [Phase 5]  08_spatial_intersection.py                      â”‚
â”‚               â†“ è¾“å…¥: dining_zones.geojson                  â”‚
â”‚               â†“       taxi_hotspots.geojson                  â”‚
â”‚               â†“ è¾“å‡º: final_hotspots.geojson                â”‚
â”‚                                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚ æ‰€æœ‰æ¨¡å—ä¾èµ–
          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    å·¥å…·æ¨¡å—å±‚                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ src/utils/          â”‚      â”‚ src/analysis/          â”‚   â”‚
â”‚  â”‚  config_loader.py   â”‚      â”‚  clustering.py         â”‚   â”‚
â”‚  â”‚ (é…ç½®åŠ è½½)           â”‚      â”‚  isochrone.py          â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â–²
          â”‚ è¯»å–
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    é…ç½®å±‚                                     â”‚
â”‚              config/config.yaml                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## äºŒã€è¯¦ç»†æ–‡ä»¶ä¾èµ–å…³ç³»

### 2.1 å…¥å£æ–‡ä»¶ä¾èµ–

#### **app.py** (Webåº”ç”¨)

**ç›´æ¥ä¾èµ–:**
```python
from flask import Flask, render_template, request, jsonify
import geopandas, pandas, numpy, shapely, json
```

**æ–‡ä»¶ä¾èµ–:**
- **è¯»å–**: `data/processed/final_hotspots.geojson`
- **ä½¿ç”¨**: `templates/index.html`

**è¢«ä¾èµ–æƒ…å†µ:** æ— ï¼ˆé¡¶å±‚åº”ç”¨ï¼‰

---

#### **run_pipeline.py** (æµç¨‹æ§åˆ¶å™¨)

**ç›´æ¥ä¾èµ–:**
```python
import subprocess, sys, logging, pathlib, time, datetime
```

**è°ƒç”¨é¡ºåº:**
1. `src/data_processing/02_process_taxi_data.py`
2. `src/data_processing/02_merge_restaurants.py`
3. `src/data_processing/06_cluster_restaurants.py`
4. `src/data_processing/07_cluster_taxi_dropoffs.py`
5. `src/data_processing/08_spatial_intersection.py`

**æ£€æŸ¥æ–‡ä»¶:**
- `config/config.yaml`
- `data/external/boundaries/nybb.shp`
- `data/raw/taxi/` (ç›®å½•)
- `data/raw/restaurants/` (ç›®å½•)

**è¢«ä¾èµ–æƒ…å†µ:** æ— ï¼ˆé¡¶å±‚æ§åˆ¶å™¨ï¼‰

---

### 2.2 å·¥å…·æ¨¡å—ä¾èµ–

#### **src/utils/config_loader.py**

**ç›´æ¥ä¾èµ–:**
```python
import yaml, pathlib
```

**æ–‡ä»¶ä¾èµ–:**
- **è¯»å–**: `config/config.yaml`

**è¢«ä¾èµ–è€…:**
- `02_process_taxi_data.py`
- `02_merge_restaurants.py`
- `06_cluster_restaurants.py`
- `07_cluster_taxi_dropoffs.py`
- `08_spatial_intersection.py`
- `clustering.py`

**æ ¸å¿ƒåŠŸèƒ½:**
- `load_config()` - åŠ è½½YAMLé…ç½®
- `get_data_path()` - è·å–æ•°æ®è·¯å¾„
- `get_config_value()` - è·å–é…ç½®å€¼

---

#### **src/analysis/clustering.py**

**ç›´æ¥ä¾èµ–:**
```python
import numpy, pandas, geopandas, hdbscan
from sklearn.metrics import silhouette_score, davies_bouldin_score
from src.utils.config_loader import load_config
```

**è¢«ä¾èµ–æƒ…å†µ:**
- ç†è®ºä¸Šå¯è¢«å¯¼å…¥ï¼Œä½†å®é™…å„å¤„ç†è„šæœ¬éƒ½æ˜¯**å†…åµŒå®ç°**è€Œéå¯¼å…¥æ­¤æ¨¡å—
- æä¾›å‚è€ƒå®ç°å’Œæµ‹è¯•ä»£ç 

---

#### **src/analysis/isochrone.py**

**ç›´æ¥ä¾èµ–:**
```python
import networkx, osmnx, geopandas, shapely
```

**æ–‡ä»¶ä¾èµ–:**
- **è¯»å–**: `data/processed/networks/network_walk.gpickle` (å¯é€‰)

**è¢«ä¾èµ–æƒ…å†µ:** ç‹¬ç«‹åŠŸèƒ½æ¨¡å—ï¼Œæœªè¢«å…¶ä»–è„šæœ¬è°ƒç”¨

**çŠ¶æ€:** å¯é€‰åŠŸèƒ½ï¼ˆç”¨äºå¯è¾¾æ€§åˆ†æï¼‰

---

### 2.3 æ•°æ®å¤„ç†æµç¨‹ä¾èµ–

#### **Phase 1: 02_process_taxi_data.py**

**ä»£ç ä¾èµ–:**
```python
import pandas, geopandas, numpy, shapely
from pathlib import Path
from pandarallel import pandarallel
from src.utils.config_loader import load_config, get_config_value
```

**è¾“å…¥æ–‡ä»¶:**
- `data/raw/taxi/*.parquet` (12ä¸ªæœˆä»½)
- `data/external/boundaries/nybb.shp` (NYCè¾¹ç•Œ)
- `data/external/boundaries/taxi_zones.shp` (å‡ºç§Ÿè½¦åŒºåŸŸ)
- `config/config.yaml`

**è¾“å‡ºæ–‡ä»¶:**
- `data/interim/taxi_dropoffs_weighted.parquet` âœ… **ä¸»è¦è¾“å‡º**
- `data/interim/taxi_dropoffs_weighted_sample.geojson`
- `data/interim/taxi_processing_summary.json`

**å…³é”®å¤„ç†:**
1. æ‰¹å¤„ç†åŠ è½½12ä¸ªæœˆParquetæ–‡ä»¶
2. LocationID â†’ ç»çº¬åº¦è½¬æ¢ï¼ˆä½¿ç”¨taxi_zones.shpï¼‰
3. è¿‡æ»¤åˆ°ç”¨é¤æ—¶é—´æ®µï¼ˆbreakfast, lunch, dinner, late-nightï¼‰
4. åº”ç”¨æ—¶é—´æƒé‡ï¼ˆå‘¨æœ«æ™šé¤1.5xï¼Œå·¥ä½œæ—¥æ™šé¤1.0xç­‰ï¼‰
5. è¿‡æ»¤åˆ°NYCè¾¹ç•Œå†…

**è¢«ä¾èµ–è€…:** `07_cluster_taxi_dropoffs.py`

---

#### **Phase 2: 02_merge_restaurants.py**

**ä»£ç ä¾èµ–:**
```python
import pandas, geopandas, shapely
from scipy.spatial import cKDTree
from fuzzywuzzy import fuzz
```

**è¾“å…¥æ–‡ä»¶:**
- `data/raw/restaurants/restaurants_nyc_googlemaps.csv`
- `data/raw/restaurants/restaurants_nyc_osm.csv`

**è¾“å‡ºæ–‡ä»¶:**
- `data/interim/restaurants_merged.geojson` âœ… **ä¸»è¦è¾“å‡º**
- `data/interim/restaurants_merged.csv`

**å…³é”®å¤„ç†:**
1. åŠ è½½Google Mapså’ŒOSMé¤å…æ•°æ®
2. æ ‡å‡†åŒ–å­—æ®µï¼ˆname, lat, lon, ratingç­‰ï¼‰
3. å»é‡ï¼ˆç©ºé—´è·ç¦»<50m + åç§°ç›¸ä¼¼åº¦>80%ï¼‰
4. ä½¿ç”¨KDTreeä¼˜åŒ–ç©ºé—´æœç´¢

**è¢«ä¾èµ–è€…:** `06_cluster_restaurants.py`

---

#### **Phase 3: 06_cluster_restaurants.py**

**ä»£ç ä¾èµ–:**
```python
import pandas, geopandas, numpy
from pathlib import Path
from shapely.geometry import MultiPoint
from hdbscan import HDBSCAN
from sklearn.metrics import silhouette_score, davies_bouldin_score
from src.utils.config_loader import load_config, get_config_value
```

**è¾“å…¥æ–‡ä»¶:**
- `data/interim/restaurants_merged.geojson` â† Phase 2
- `config/config.yaml`

**è¾“å‡ºæ–‡ä»¶:**
- `data/processed/dining_zones.geojson` âœ… **ä¸»è¦è¾“å‡º**
- `data/processed/restaurants_clustered.geojson`
- `data/processed/clustering_metrics.json`

**å…³é”®å¤„ç†:**
1. æŠ•å½±åˆ°EPSG:2263ï¼ˆç±³åˆ¶åæ ‡ï¼‰
2. HDBSCANèšç±»ï¼ˆmin_cluster_size=30, epsilon=200mï¼‰
3. ç”Ÿæˆå‡¸åŒ… + ç¼“å†²åŒº(100m) â†’ dining zones
4. è®¡ç®—éªŒè¯æŒ‡æ ‡ï¼ˆSilhouette, Davies-Bouldinï¼‰

**è¢«ä¾èµ–è€…:** `08_spatial_intersection.py`

---

#### **Phase 4: 07_cluster_taxi_dropoffs.py**

**ä»£ç ä¾èµ–:**
```python
import pandas, geopandas, numpy
from shapely.geometry import MultiPoint
from hdbscan import HDBSCAN
from sklearn.metrics import silhouette_score, davies_bouldin_score
from src.utils.config_loader import load_config, get_config_value
```

**è¾“å…¥æ–‡ä»¶:**
- `data/interim/taxi_dropoffs_weighted.parquet` â† Phase 1
- `config/config.yaml`

**è¾“å‡ºæ–‡ä»¶:**
- `data/processed/taxi_hotspots.geojson` âœ… **ä¸»è¦è¾“å‡º**
- `data/processed/taxi_dropoffs_clustered.parquet`
- `data/processed/taxi_clustering_metrics.json`

**å…³é”®å¤„ç†:**
1. åŠ è½½å¸¦æƒé‡çš„å‡ºç§Ÿè½¦æ•°æ®
2. å¯é€‰H3èšåˆï¼ˆå‡å°‘æ•°æ®é‡ï¼‰
3. æ ¹æ®æƒé‡å¤åˆ¶ç‚¹ï¼ˆweight=1.5 â†’ å¤åˆ¶2æ¬¡ï¼‰
4. HDBSCANèšç±»ï¼ˆmin_cluster_size=50, epsilon=250mï¼‰
5. ç”Ÿæˆå‡¸åŒ… + ç¼“å†²åŒº(150m) â†’ taxi hotspots

**è¢«ä¾èµ–è€…:** `08_spatial_intersection.py`

---

#### **Phase 5: 08_spatial_intersection.py**

**ä»£ç ä¾èµ–:**
```python
import geopandas, pandas, numpy
from shapely.geometry import Polygon, MultiPolygon
from shapely.ops import unary_union
from src.utils.config_loader import load_config, get_config_value
```

**è¾“å…¥æ–‡ä»¶:**
- `data/processed/dining_zones.geojson` â† Phase 3
- `data/processed/taxi_hotspots.geojson` â† Phase 4
- `config/config.yaml`

**è¾“å‡ºæ–‡ä»¶:**
- `data/processed/final_hotspots.geojson` âœ… **æœ€ç»ˆè¾“å‡º**
- `data/processed/intersection_analysis.json`

**å…³é”®å¤„ç†:**
1. ç©ºé—´æ±‚äº¤ï¼šdining_zones âˆ© taxi_hotspots
2. è¿‡æ»¤æ¡ä»¶ï¼š
   - æœ€å°é¢ç§¯ â‰¥ 10,000 mÂ²
   - æœ€å°é‡å ç‡ â‰¥ 15%
3. è®¡ç®—å¤åˆå¾—åˆ†ï¼š
   - restaurant_score (é¤å…å¯†åº¦å½’ä¸€åŒ–)
   - taxi_score (å‡ºç§Ÿè½¦å¯†åº¦å½’ä¸€åŒ–)
   - popularity_score = 0.5Ã—restaurant + 0.5Ã—taxi
4. æ’åå¹¶è¾“å‡ºtop N

**è¢«ä¾èµ–è€…:** `app.py`, `01_visualize_results.py`

---

### 2.4 å¯è§†åŒ–æ¨¡å—ä¾èµ–

#### **src/visualization/01_visualize_results.py**

**ä»£ç ä¾èµ–:**
```python
import geopandas, pandas, folium
from folium import plugins
```

**è¾“å…¥æ–‡ä»¶:**
- `data/processed/restaurants_clustered.geojson`
- `data/processed/dining_zones.geojson`
- `data/processed/taxi_hotspots.geojson`
- `data/processed/final_hotspots.geojson`

**è¾“å‡ºæ–‡ä»¶:**
- `maps/01_restaurants_clusters.html`
- `maps/02_taxi_hotspots.html`
- `maps/03_final_hotspots.html`

**è¢«ä¾èµ–æƒ…å†µ:** ç‹¬ç«‹æ‰§è¡Œï¼Œä¸è¢«å…¶ä»–æ¨¡å—ä¾èµ–

---

## ä¸‰ã€æ•°æ®æµä¾èµ–å›¾

### 3.1 å®Œæ•´æ•°æ®æµ

```
åŸå§‹æ•°æ®æº
â”œâ”€ data/raw/taxi/*.parquet (12ä¸ªæœˆ)
â”œâ”€ data/raw/restaurants/restaurants_nyc_googlemaps.csv
â”œâ”€ data/raw/restaurants/restaurants_nyc_osm.csv
â”œâ”€ data/external/boundaries/nybb.shp
â””â”€ data/external/boundaries/taxi_zones.shp
        â”‚
        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Phase 1: 02_process_taxi_data.py             â”‚
â”‚  â””â”€â†’ data/interim/taxi_dropoffs_weighted.parquet
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â”‚                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                   â”‚ Phase 2: 02_merge_restaurants.py    â”‚
        â”‚                   â”‚ â””â”€â†’ data/interim/restaurants_merged.geojson
        â”‚                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚                                   â”‚
        â–¼                                   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Phase 4:                    â”‚   â”‚ Phase 3:                     â”‚
â”‚ 07_cluster_taxi_dropoffs.py â”‚   â”‚ 06_cluster_restaurants.py    â”‚
â”‚ â””â”€â†’ taxi_hotspots.geojson   â”‚   â”‚ â””â”€â†’ dining_zones.geojson     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚                                   â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ Phase 5:                              â”‚
        â”‚ 08_spatial_intersection.py            â”‚
        â”‚ â””â”€â†’ data/processed/                   â”‚
        â”‚     final_hotspots.geojson            â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â–¼                        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ app.py            â”‚   â”‚ 01_visualize_results.pyâ”‚
â”‚ (Webåº”ç”¨)          â”‚   â”‚ (å¯è§†åŒ–)                â”‚
â”‚ â†’ 127.0.0.1:5000  â”‚   â”‚ â†’ maps/*.html          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### 3.2 å…³é”®æ•°æ®æ–‡ä»¶ä¾èµ–çŸ©é˜µ

| è¾“å‡ºæ–‡ä»¶ | è¢«å“ªäº›è„šæœ¬ä½¿ç”¨ | ä¾èµ–å“ªäº›è¾“å…¥æ–‡ä»¶ |
|---------|---------------|----------------|
| `taxi_dropoffs_weighted.parquet` | 07_cluster_taxi_dropoffs.py | raw/taxi/*.parquet, boundaries/nybb.shp, taxi_zones.shp |
| `restaurants_merged.geojson` | 06_cluster_restaurants.py | raw/restaurants/*.csv |
| `dining_zones.geojson` | 08_spatial_intersection.py, 01_visualize_results.py | restaurants_merged.geojson |
| `taxi_hotspots.geojson` | 08_spatial_intersection.py, 01_visualize_results.py | taxi_dropoffs_weighted.parquet |
| `final_hotspots.geojson` | app.py, 01_visualize_results.py | dining_zones.geojson, taxi_hotspots.geojson |

---

## å››ã€é…ç½®æ–‡ä»¶ä¾èµ–

### **config/config.yaml**

è¢«ä»¥ä¸‹æ‰€æœ‰å¤„ç†è„šæœ¬è¯»å–ï¼š
- `02_process_taxi_data.py` - æ—¶é—´æƒé‡ã€CRSé…ç½®
- `06_cluster_restaurants.py` - HDBSCANå‚æ•°ã€ç¼“å†²è·ç¦»
- `07_cluster_taxi_dropoffs.py` - HDBSCANå‚æ•°ã€H3é…ç½®
- `08_spatial_intersection.py` - è¿‡æ»¤é˜ˆå€¼

**å…³é”®é…ç½®é¡¹:**
```yaml
clustering:
  restaurants:
    min_cluster_size: 30
    min_samples: 10
    cluster_selection_epsilon: 200  # meters

  taxi:
    min_cluster_size: 50
    min_samples: 15
    cluster_selection_epsilon: 250  # meters

temporal:
  weights:
    weekend_dinner: 1.5
    weekday_dinner: 1.0
    weekday_lunch: 0.8
    breakfast: 0.5

intersection:
  min_area_sqm: 10000
  min_overlap_ratio: 0.15
```

---

## äº”ã€ç¬¬ä¸‰æ–¹åº“ä¾èµ–

### 5.1 æ ¸å¿ƒæ•°æ®å¤„ç†
```
pandas>=2.0.0          # æ•°æ®æ¡†æ¶
numpy>=1.24.0          # æ•°å€¼è®¡ç®—
geopandas>=0.14.0      # åœ°ç†ç©ºé—´æ•°æ®
shapely>=2.0.0         # å‡ ä½•æ“ä½œ
pyproj>=3.6.0          # æŠ•å½±è½¬æ¢
```

### 5.2 æœºå™¨å­¦ä¹ 
```
hdbscan>=0.8.33        # å¯†åº¦èšç±»
scikit-learn>=1.3.0    # éªŒè¯æŒ‡æ ‡
scipy>=1.10.0          # KDTreeç©ºé—´ç´¢å¼•
```

### 5.3 æ•°æ®åŠ è½½
```
pyarrow>=12.0.0        # Parquetæ–‡ä»¶æ”¯æŒ
fiona>=1.9.0           # Shapefileæ”¯æŒ
```

### 5.4 Webä¸å¯è§†åŒ–
```
flask>=2.3.0           # Webæ¡†æ¶
folium>=0.14.0         # äº¤äº’å¼åœ°å›¾
```

### 5.5 ä¼˜åŒ–åº“ï¼ˆå¯é€‰ï¼‰
```
pandarallel>=1.6.0     # å¹¶è¡Œpandasæ“ä½œ
h3>=3.7.6              # å…­è¾¹å½¢ç©ºé—´ç´¢å¼•
rtree>=1.0.1           # R-treeç©ºé—´ç´¢å¼•
```

---

## å…­ã€æ‰§è¡Œé¡ºåºçº¦æŸ

### 6.1 å¿…é¡»é¡ºåºæ‰§è¡Œ

```
1. 02_process_taxi_data.py        â† å¿…é¡»æœ€å…ˆæ‰§è¡Œ
   â”‚
2. 02_merge_restaurants.py        â† å¯ä¸æ­¥éª¤1å¹¶è¡Œ
   â”‚
   â”œâ”€â†’ 3. 06_cluster_restaurants.py
   â”‚
   â””â”€â†’ 4. 07_cluster_taxi_dropoffs.py  â† æ­¥éª¤3ã€4å¯å¹¶è¡Œ
   â”‚
5. 08_spatial_intersection.py     â† å¿…é¡»åœ¨æ­¥éª¤3ã€4å®Œæˆå
```

### 6.2 å¯é€‰æ‰§è¡Œ

- `01_visualize_results.py` - ä»»ä½•æ—¶å€™ï¼ˆéœ€è¦processedæ•°æ®ï¼‰
- `app.py` - ä»»ä½•æ—¶å€™ï¼ˆéœ€è¦final_hotspots.geojsonï¼‰

---

## ä¸ƒã€ç¼“å­˜æœºåˆ¶

### **cache/** ç›®å½•

åŒ…å«è‹¥å¹² `.json` ç¼“å­˜æ–‡ä»¶ï¼ˆå“ˆå¸Œå‘½åï¼‰ï¼Œç”¨äºï¼š
- APIè¯·æ±‚ç¼“å­˜ï¼ˆå¯èƒ½æ¥è‡ªGoogle Maps APIï¼‰
- ä¸­é—´è®¡ç®—ç»“æœç¼“å­˜

**ä¾èµ–æƒ…å†µ:** æ— ç›´æ¥ä»£ç ä¾èµ–ï¼Œç³»ç»Ÿé€æ˜ç®¡ç†

---

## å…«ã€ä¾èµ–å…³ç³»æ€»ç»“

### 8.1 å¼ºä¾èµ–ï¼ˆå¿…éœ€ï¼‰

```
run_pipeline.py
  â†“
  â”œâ”€ config/config.yaml
  â”œâ”€ src/utils/config_loader.py
  â”œâ”€ data/raw/* (æ‰€æœ‰åŸå§‹æ•°æ®)
  â””â”€ data/external/boundaries/*.shp

app.py
  â†“
  â””â”€ data/processed/final_hotspots.geojson
```

### 8.2 å¼±ä¾èµ–ï¼ˆå¯é€‰ï¼‰

```
src/analysis/isochrone.py
  â†“ (å¯é€‰)
  â””â”€ data/processed/networks/*.gpickle

01_visualize_results.py
  â†“ (å¯é€‰)
  â””â”€ data/processed/*.geojson
```

### 8.3 æ— ä¾èµ–ï¼ˆç‹¬ç«‹ï¼‰

- `templates/index.html` - çº¯HTMLæ¨¡æ¿
- `docs/*.md` - æ–‡æ¡£æ–‡ä»¶
- `outputs/*` - è¾“å‡ºç›®å½•

---

## ä¹ã€ä¾èµ–ç ´åé£é™©åˆ†æ

### é«˜é£é™©ä¾èµ–

| å¦‚æœåˆ é™¤/æŸå... | å½±å“èŒƒå›´ |
|----------------|---------|
| `config/config.yaml` | ğŸ”´ **æ‰€æœ‰å¤„ç†è„šæœ¬å¤±è´¥** |
| `src/utils/config_loader.py` | ğŸ”´ **æ‰€æœ‰å¤„ç†è„šæœ¬å¤±è´¥** |
| `data/interim/taxi_dropoffs_weighted.parquet` | ğŸ”´ Phase 4-5å¤±è´¥ |
| `data/interim/restaurants_merged.geojson` | ğŸ”´ Phase 3å¤±è´¥ â†’ Phase 5å¤±è´¥ |
| `data/processed/final_hotspots.geojson` | ğŸ”´ Webåº”ç”¨æ— æ³•å¯åŠ¨ |

### ä¸­é£é™©ä¾èµ–

| å¦‚æœåˆ é™¤/æŸå... | å½±å“èŒƒå›´ |
|----------------|---------|
| `data/external/boundaries/taxi_zones.shp` | ğŸŸ¡ Phase 1å¤±è´¥ï¼ˆLocationIDè½¬æ¢ï¼‰ |
| `data/processed/dining_zones.geojson` | ğŸŸ¡ Phase 5å¤±è´¥ |
| `data/processed/taxi_hotspots.geojson` | ğŸŸ¡ Phase 5å¤±è´¥ |

### ä½é£é™©ä¾èµ–

| å¦‚æœåˆ é™¤/æŸå... | å½±å“èŒƒå›´ |
|----------------|---------|
| `01_visualize_results.py` | âšª ä»…å¯è§†åŒ–å¤±è´¥ |
| `src/analysis/isochrone.py` | âšª æ— å½±å“ï¼ˆæœªä½¿ç”¨ï¼‰ |
| `cache/*.json` | âšª ä»…æ€§èƒ½ä¸‹é™ï¼Œéœ€é‡æ–°è®¡ç®— |

---

## åã€ä¾èµ–ä¼˜åŒ–å»ºè®®

### 10.1 æ¨¡å—åŒ–æ”¹è¿›

**å½“å‰é—®é¢˜:** èšç±»ä»£ç åœ¨å„è„šæœ¬ä¸­é‡å¤å®ç°

**å»ºè®®:** ç»Ÿä¸€ä½¿ç”¨ `src/analysis/clustering.py`
```python
# æ›¿ä»£å½“å‰å†…åµŒçš„HDBSCANä»£ç 
from src.analysis.clustering import cluster_restaurants, cluster_taxi_dropoffs
```

### 10.2 é…ç½®ç®¡ç†

**å½“å‰:** ç¡¬ç¼–ç æ–‡ä»¶è·¯å¾„

**å»ºè®®:** å…¨éƒ¨è·¯å¾„é€šè¿‡é…ç½®ç®¡ç†
```python
# æ›¿ä»£ "data/interim/taxi_dropoffs_weighted.parquet"
from src.utils.config_loader import get_data_path
input_path = get_data_path("interim.taxi_filtered")
```

### 10.3 ä¾èµ–æ³¨å…¥

**å½“å‰:** run_pipeline.pyç›´æ¥è°ƒç”¨subprocess

**å»ºè®®:** ä½¿ç”¨å‡½æ•°å¯¼å…¥
```python
# æ›¿ä»£ subprocess.run([sys.executable, script_path])
from src.data_processing.process_taxi import main as process_taxi
process_taxi()
```

---

## åä¸€ã€ä¾èµ–å…³ç³»å¿«é€ŸæŸ¥è¯¢

### é—®ï¼š"å¦‚æœæˆ‘ä¿®æ”¹äº†é¤å…æ•°æ®ï¼Œéœ€è¦é‡æ–°è¿è¡Œå“ªäº›è„šæœ¬ï¼Ÿ"

**ç­”:**
```
1. 02_merge_restaurants.py           (é‡æ–°åˆå¹¶)
2. 06_cluster_restaurants.py         (é‡æ–°èšç±»)
3. 08_spatial_intersection.py        (é‡æ–°æ±‚äº¤)
```

### é—®ï¼š"å¦‚æœæˆ‘åªæƒ³æ›´æ–°Webåº”ç”¨æ˜¾ç¤ºæ•ˆæœï¼Œéœ€è¦é‡æ–°å¤„ç†æ•°æ®å—ï¼Ÿ"

**ç­”:** ä¸éœ€è¦ï¼Œåªéœ€ä¿®æ”¹ï¼š
- `app.py` (åç«¯é€»è¾‘)
- `templates/index.html` (å‰ç«¯å±•ç¤º)

### é—®ï¼š"å¦‚æœæˆ‘ä¿®æ”¹äº†èšç±»å‚æ•°ï¼Œä¼šå½±å“å“ªäº›è¾“å‡ºï¼Ÿ"

**ç­”:**
- ä¿®æ”¹ `clustering.restaurants.*` â†’ å½±å“ `dining_zones.geojson` â†’ å½±å“ `final_hotspots.geojson`
- ä¿®æ”¹ `clustering.taxi.*` â†’ å½±å“ `taxi_hotspots.geojson` â†’ å½±å“ `final_hotspots.geojson`

---

## åäºŒã€ä¾èµ–æ£€æŸ¥æ¸…å•

### å¯åŠ¨å‰æ£€æŸ¥
```bash
# 1. é…ç½®æ–‡ä»¶
âœ“ config/config.yaml

# 2. åŸå§‹æ•°æ®
âœ“ data/raw/taxi/*.parquet (12ä¸ªæ–‡ä»¶)
âœ“ data/raw/restaurants/restaurants_nyc_googlemaps.csv
âœ“ data/raw/restaurants/restaurants_nyc_osm.csv

# 3. è¾¹ç•Œæ•°æ®
âœ“ data/external/boundaries/nybb.shp
âœ“ data/external/boundaries/taxi_zones.shp

# 4. Pythonç¯å¢ƒ
âœ“ requirements.txt ä¸­æ‰€æœ‰åº“å·²å®‰è£…
```

### è¿è¡Œåæ£€æŸ¥
```bash
# Phase 1è¾“å‡º
âœ“ data/interim/taxi_dropoffs_weighted.parquet

# Phase 2è¾“å‡º
âœ“ data/interim/restaurants_merged.geojson

# Phase 3è¾“å‡º
âœ“ data/processed/dining_zones.geojson
âœ“ data/processed/restaurants_clustered.geojson

# Phase 4è¾“å‡º
âœ“ data/processed/taxi_hotspots.geojson

# Phase 5è¾“å‡ºï¼ˆæœ€ç»ˆï¼‰
âœ“ data/processed/final_hotspots.geojson
```

---

**æ–‡æ¡£ç‰ˆæœ¬:** v1.0
**æœ€åæ›´æ–°:** 2025-11-17
**ç»´æŠ¤è€…:** WHERE-TO-DINE Project Team
