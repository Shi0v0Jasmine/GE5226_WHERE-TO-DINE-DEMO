# Main Configuration File for "Where to DINE" Project
# Version: 1.0

# ==================== DATA PATHS ====================
data:
  raw:
    taxi_dir: "data/raw/taxi/"
    restaurants_google: "data/raw/restaurants/restaurants_nyc_googlemaps.csv"
    restaurants_osm_csv: "data/raw/restaurants/restaurants_nyc_osm.csv"
    restaurants_osm_geojson: "data/raw/restaurants/restaurants_nyc_osm.geojson"
    gtfs_dir: "data/raw/gtfs/"
    osm_dir: "data/raw/osm/"

  interim:
    taxi_filtered: "data/interim/taxi_filtered_dining_hours.parquet"
    restaurants_merged: "data/interim/restaurants_merged.geojson"
    gtfs_unpacked: "data/interim/gtfs_unpacked/"

  processed:
    dining_zones: "data/processed/dining_zones.geojson"
    taxi_hotspots: "data/processed/taxi_hotspot_areas.geojson"
    final_hotspots: "data/processed/dining_hotspots_final.geojson"
    network_drive: "data/processed/network_dataset/osm_drive_network.graphml"
    network_walk: "data/processed/network_dataset/osm_walk_network.graphml"
    network_transit: "data/processed/network_dataset/transit_network.graphml"

  external:
    nyc_boroughs: "data/external/nyc_boroughs.geojson"
    nyc_neighborhoods: "data/external/nyc_neighborhoods.geojson"

# ==================== GEOGRAPHIC EXTENT ====================
geographic:
  # NYC Bounding Box
  bbox:
    north: 40.9176
    south: 40.4774
    east: -73.7004
    west: -74.2591

  # Coordinate Reference Systems
  crs:
    wgs84: "EPSG:4326"  # For storage and display
    projected: "EPSG:2263"  # NAD83 / New York Long Island (meters)

# ==================== TEMPORAL FILTERING ====================
temporal:
  # Dining hours definitions (24-hour format)
  dining_hours:
    breakfast:
      start: 7
      end: 10
    lunch:
      start: 11
      end: 14
    dinner:
      start: 17
      end: 22
    late_night:
      start: 22
      end: 1  # Wraps to next day

  # Temporal weights for taxi drop-offs
  # Values reflect relative importance of different time periods
  weights:
    weekday_dinner: 1.0  # Baseline
    weekend_dinner: 1.5  # Higher preference
    weekday_lunch: 0.8
    weekend_lunch: 1.0   # Weekend brunch
    breakfast: 0.5
    late_night_weekend: 0.7
    late_night_weekday: 0.4
    off_peak: 0.3

# ==================== CLUSTERING PARAMETERS ====================
clustering:
  # Restaurant clustering (HDBSCAN)
  restaurants:
    min_cluster_size: 30      # Minimum 30 restaurants for a viable cluster
    min_samples: 10           # Conservative density estimate
    cluster_selection_epsilon: 200  # 200 meters
    metric: "euclidean"       # After projection to meters
    cluster_selection_method: "eom"  # Excess of Mass

  # Taxi drop-off clustering (HDBSCAN)
  taxi:
    min_cluster_size: 50
    min_samples: 15
    cluster_selection_epsilon: 250  # 250 meters
    metric: "euclidean"
    cluster_selection_method: "eom"
    use_h3_aggregation: false  # Set to true for very large datasets (>10M points)
    h3_resolution: 10          # H3 resolution (if aggregation enabled)

  # Buffer distances for polygon generation (meters)
  dining_zone_buffer: 100      # Buffer around restaurant clusters
  taxi_hotspot_buffer: 150     # Buffer around taxi clusters

  # Polygon generation (deprecated - use dining_zone_buffer/taxi_hotspot_buffer)
  polygons:
    buffer_meters_restaurants: 100  # Buffer around restaurant clusters
    buffer_meters_taxi: 150         # Buffer around taxi clusters
    min_area_sqm: 10000            # Minimum 0.01 sq km for final hotspots

# ==================== SPATIAL DEDUPLICATION ====================
deduplication:
  distance_threshold_meters: 50  # Consider duplicates if within 50m
  name_similarity_threshold: 80  # 80% Levenshtein similarity

# ==================== SPATIAL INTERSECTION ====================
intersection:
  # Filtering criteria for final hotspots
  min_area_sqm: 10000       # Minimum 10,000 m² (approx 2-3 NYC blocks)
  min_overlap_ratio: 0.15   # Minimum 15% overlap between dining zones and taxi hotspots

# ==================== NETWORK ANALYSIS ====================
network:
  # Travel speeds (km/h)
  speeds:
    driving_urban: 25      # Average NYC driving speed
    walking: 4.8           # Standard walking speed
    cycling: 15            # If implementing cycling mode

  # Service area (isochrone) time thresholds (minutes)
  isochrone_times:
    walking: [5, 10, 15]
    driving: [10, 20, 30]
    transit: [15, 30, 45]

  # Transit parameters
  transit:
    transfer_penalty_min: 5   # Time penalty for each transfer
    max_wait_time_min: 15     # Maximum wait time at stops
    max_transfers: 2          # Maximum number of transfers allowed

# ==================== RECOMMENDATION SCORING ====================
recommendation:
  # Scoring weights (must sum to 1.0)
  weights:
    popularity: 0.6      # α: Weight for hotspot popularity score
    accessibility: 0.4   # β: Weight for travel time accessibility

  # Normalization
  # Popularity score is already normalized [0, 100] from hotspot detection
  # Accessibility score: 100 * (1 - travel_time / max_travel_time)

# ==================== VALIDATION ====================
validation:
  # Cross-validation
  test_size: 0.2          # 20% holdout for testing
  random_seed: 42         # For reproducibility

  # Ground truth dining districts (for validation)
  known_districts:
    - name: "Koreatown"
      lat: 40.7484
      lon: -73.9869
      radius_km: 0.5
    - name: "Little Italy"
      lat: 40.7188
      lon: -73.9976
      radius_km: 0.3
    - name: "Chinatown"
      lat: 40.7158
      lon: -73.9977
      radius_km: 0.4
    - name: "Financial District"
      lat: 40.7074
      lon: -74.0113
      radius_km: 0.5
    - name: "Williamsburg"
      lat: 40.7081
      lon: -73.9571
      radius_km: 0.6

# ==================== H3 SPATIAL INDEXING ====================
h3:
  resolution: 10  # Resolution 10: ~15m edge length
  # Higher resolution = finer grain but more cells

# ==================== PERFORMANCE ====================
performance:
  # Parallel processing
  n_jobs: -1  # Use all CPU cores (-1)

  # Memory management
  chunk_size: 100000  # Process taxi data in chunks

  # Sampling (if data too large)
  taxi_sample_fraction: 1.0  # 1.0 = use all data, 0.1 = use 10%

# ==================== VISUALIZATION ====================
visualization:
  # Map settings
  map:
    default_zoom: 11
    center_lat: 40.7128
    center_lon: -74.0060
    tile_provider: "OpenStreetMap"  # or "CartoDB positron", "Stamen Terrain"

  # Color schemes
  colors:
    hotspot_high: "#FF0000"      # High score hotspots
    hotspot_medium: "#FFA500"    # Medium score
    hotspot_low: "#FFFF00"       # Low score
    isochrone_walk: "#0000FF"
    isochrone_drive: "#00FF00"
    isochrone_transit: "#FF00FF"

  # Figure settings
  figure:
    dpi: 300  # For publication quality
    format: "png"
    figsize: [12, 10]

# ==================== WEB APPLICATION ====================
web_app:
  # Flask/FastAPI settings
  host: "127.0.0.1"
  port: 5000
  debug: true

  # API rate limits
  rate_limit:
    requests_per_minute: 60
    requests_per_hour: 1000

# ==================== LOGGING ====================
logging:
  level: "INFO"  # DEBUG, INFO, WARNING, ERROR, CRITICAL
  format: "%(asctime)s - %(name)s - %(levelname)s - %(message)s"
  file: "outputs/logs/project.log"

# ==================== METADATA ====================
metadata:
  project_name: "Where to DINE"
  version: "1.0.0"
  authors:
    - "Your Name"
  institution: "Your University"
  course: "GIS Capstone"
  date: "2025-11-09"
